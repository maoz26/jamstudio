<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Studio</title>
	<link rel="icon" type="image/png" href="https://jammeapp.herokuapp.com/static/includes/images/favicon.png">
	<link rel="stylesheet" type="text/css" href="https://jammeapp.herokuapp.com/static/includes/style/dashboard.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://jammeapp.herokuapp.com/static/includes/style/jquery-ui.min.css">
	<script src="https://jammeapp.herokuapp.com/static/includes/scripts/jquery-ui.min.js"></script>
	<script src="https://jammeapp.herokuapp.com/static/includes/scripts/controllerAPI.js"></script>
	<script src="https://jammeapp.herokuapp.com/static/includes/scripts/studioUI.js"></script>
	<script src="https://jammeapp.herokuapp.com/static/includes/scripts/slider-widjet.js"></script>
	
	<!-- -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Bootstrap 101 Template</title>
    <!-- Bootstrap -->
    <link href="https://jammeapp.herokuapp.com/static/includes/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	<!--  -->

</head>
<body class="dashboard noselect">
	<header>
		<ul>
			<li id="logo">J</li>
			<li id="connected_user">
				<div class="user_img" style="background-image: url()"></div>
				<div class="username"><span>israel.israeli@gmail.com</span> <span>&#x25BC;</span></div>
				<section id="connected_user_menu">
					<ul>
						<li id="logout">Logout</li>
					</ul>
				</section>
			</li>
			<li id="search-line">
				<div>
                    <div class="input-group col-md-12">
                        <input type="text" class="  search-query form-control" placeholder="Search" />
                        <span class="input-group-btn">
                            <button class="btn" type="button">
                                <span class=" glyphicon glyphicon-search"></span>
                            </button>
                        </span>
                    </div>
				</div>
			</li>
			<li id="searchbox"></li>
		</ul>
	</header>
	<main class="scrolls">
		<section class="slider-widjet">	
			<div class="arrowSlider next">next</div>
			<div class="arrowSlider back">back</div>
			<div class="canvas"><div>
		</section>		

		<div id="create_project" data-toggle="modal" data-target="#exampleModal"></div>
	</main>
	<section>
		<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
		  <div class="modal-dialog" role="document">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        <h4 class="modal-title" id="exampleModalLabel">New Project</h4>
		      </div>
		      <div class="modal-body">
		        <form>
		          <div class="form-group">
		            <label for="recipient-name" class="control-label">Name:</label>
		            <input type="text" class="form-control" id="project-name">
		          </div>
		          <div class="form-group">
		            <label for="recipient-name" class="control-label">Description:</label>
					<textarea class="form-control" rows="2" id="project-description"></textarea>
		          </div>
		          <div class="form-group">
		            <label for="recipient-name" class="control-label" id="project-genre">Genre:</label>
					<select class="form-control">
					  <option>General</option>
					  <option>African</option>
					  <option>Asian - East Asian</option>
					  <option>Asian - South and southeast Asian</option>
					  <option>Avant-garde</option>
					  <option>Blues</option>
					  <option>Caribbean and Caribbean-influenced</option>
					  <option>Comedy</option>
					  <option>Country</option>
					  <option>Easy listening</option>
					  <option>Electronic</option>
					  <option>Folk</option>
					  <option>Hip hop</option>
					  <option>Jazz</option>
					  <option>Latin</option>
					  <option>Pop</option>
					  <option>R&B and soul</option>
					  <option>Rock</option>
					</select>		          
				  </div>
		        </form>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		        <button type="button" class="btn btn-primary" id="btn-create-project">Create</button>
		      </div>
		    </div>
		  </div>
		</div>
	</section>
	<nav id="mySidenav" class="sidenav">
		<ul>
		  	<li>
		  		<a href="#" id="close_nav" class="closebtn">&times;</a>
		  	</li>
			<li id="nav_settings">
				<a href="#">Settings</a>
			</li>
			<li id="nav_versions">
				<a href="#">Versions</a>
			</li>
			<li id="nav_contributors">
				<a href="#">Contributors</a>
			</li>
			<li id="nav_issues">
				<a href="#">Issues</a>
			</li>
			<li id="nav_exit">
				<a href="#">Exit</a>
			</li>
		</ul>
	</nav>
	<section id="loader">
		<div></div>
	</section>
	<section id="contextmenu"></section>

	<script>

		var ctlAPI = new controllerAPI();
		var ctlUI = new studioUI();
		var ctlUser = new user();
		var projects = {};

		// Init studio
		ctlAPI.getUserInfo(function(result){

			ctlUser.init(result);

			ctlAPI.getProjectList(result._id,function(_result){
				initSlider(_result.admin.concat(_result.contributor));
				projects = _result.admin.concat(_result.contributor);
			});
			
		});

		function initSlider(projects){
			var slider = new slider_widjet({
					container: '.slider-widjet',
					itemHeight: 250,
					itemWidth: 180,
					arr: projects
				});
			slider.print();
			$(document).on('click','.next',function(e){			
				slider.next();
			});
			$(document).on('click','.back',function(e){
				slider.back()
			});
		}

		var rtime;
		var timeout = false;
		var delta = 200;
		$(window).resize(function() {
		    rtime = new Date();
		    if (timeout === false) {
		        timeout = true;
		        setTimeout(resizeend, delta);
		    }
		});
		function resizeend() {
		    if (new Date() - rtime < delta) {
		        setTimeout(resizeend, delta);
		    } else {
		        timeout = false;
		        console.log(projects);
		        initSlider(projects);
		    }               
		}

		function user(){

			user.user = null;
			user.files = null;
			user.sharedFiles = null;

			this.init = function(data){
				user.user = data;
	            $('div.username span:first').text(data.email);
	            $('header #connected_user .user_img').css('background-image','url('+data.picture+')');
			};
		};
		$(document).on('click','.settings',function(e){
			console.log(window.location.host)
			window.location = 'project/'+$(e.target).attr("data-project");
		});
		$(document).on('click','#btn-create-project',function(e){
			ctlAPI.createProject({
				adminUser: user.user._id,
			    name: $('#project-name').val(),
			    description: $('#project-description').val(),
			    genre: $('#project-genre').val()
			},function(result){
				if(result)
					window.location.href = 'studio/'+result._id;
			});
		});
		
		$(document).on('click','#connected_user',function(e){
			switch(e.target.id){
				case 'logout':{
					ctlAPI.logout(function(data){					
						location.reload();					  
					});
					break;
				}
			}
			$('#connected_user_menu').toggle();
		});
		
	</script>

    <script src="https://jammeapp.herokuapp.com/static/includes/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</body>
</html>